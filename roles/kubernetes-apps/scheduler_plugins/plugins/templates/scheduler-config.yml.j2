apiVersion: kubescheduler.config.k8s.io/v1
kind: KubeSchedulerConfiguration
leaderElection:
  leaderElect: {{ enable_leader_election | lower }}
  leaseDuration: {{ kube_scheduler_leader_elect_lease_duration }}
  renewDeadline: {{ kube_scheduler_leader_elect_renew_deadline }}
{% for key in kube_scheduler_leader_elect_extra_opts %}
  {{ key }}: {{ kube_scheduler_leader_elect_extra_opts[key] }}
{% endfor %}
clientConnection:
  kubeconfig: {{ kube_config_dir }}/scheduler.conf
{% if kube_scheduler_extenders %}
extenders:
{{ kube_scheduler_extenders | to_nice_yaml(indent=2, width=256) }}
{% endif %}
profiles:
- schedulerName: default-scheduler
{% if scheduler_plugins_custom_profile is defined and scheduler_plugins_custom_profile != "" %}
{{ scheduler_plugins_custom_profile | indent(2, true) }}
{% else %}
{% set profile = {} %}
{% for scheduler_plugin in scheduler_plugins %}
{% set profile_var = 'scheduler_plugins_' + (scheduler_plugin | lower) + '_profile' %}
{% set _ = profile.update(profile | combine((lookup('vars', profile_var) | from_yaml), recursive=True, list_merge='append_rp')) %}
{% endfor %}
{{ profile | to_nice_yaml(indent=2, width=256) | indent(2, true) }}
{% endif %}
{% for key in kube_scheduler_config_extra_opts %}
{{ key }}: {{ kube_scheduler_config_extra_opts[key] }}
{% endfor %}
