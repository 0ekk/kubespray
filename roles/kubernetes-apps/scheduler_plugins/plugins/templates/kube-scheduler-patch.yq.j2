{# Step 6 in https://github.com/kubernetes-sigs/scheduler-plugins/blob/v0.27.8/doc/install.md#as-a-single-scheduler-replacing-the-vanilla-default-scheduler #}
del(.spec.containers[0].command[] | select(test("--config=|--kubeconfig=|--leader-elect=")))  |
del(.spec.containers[0].volumeMounts[] | select(.name == "sched-cc")) |
del(.spec.volumes[] | select(.name == "sched-cc")) |
.spec.containers[0].command += "--config={{ scheduler_configuration_path }}" |
.spec.containers[0].image = "{{ scheduler_plugins_kube_scheduler_image_repo }}:{{ scheduler_plugins_kube_scheduler_image_tag }}" |
.spec.containers[0].volumeMounts += {"mountPath": "{{ scheduler_configuration_path }}", "name": "sched-cc", "readOnly": true} |
.spec.volumes += {"hostPath": {"path": "{{ scheduler_configuration_path }}", "type": "FileOrCreate"}, "name": "sched-cc"}